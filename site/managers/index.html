
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="../server_routes/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.21">
    
    
      
        <title>Preprocessing - ProcessProphet docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#preprocessing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ProcessProphet docs" class="md-header__button md-logo" aria-label="ProcessProphet docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ProcessProphet docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Preprocessing
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ProcessProphet docs" class="md-nav__button md-logo" aria-label="ProcessProphet docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ProcessProphet docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Preprocessing
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Preprocessing
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server.preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      preprocessing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.add_unique_start_end_activity" class="md-nav__link">
    <span class="md-ellipsis">
      add_unique_start_end_activity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.encode_df_columns" class="md-nav__link">
    <span class="md-ellipsis">
      encode_df_columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.find_end_activities" class="md-nav__link">
    <span class="md-ellipsis">
      find_end_activities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.find_start_activities" class="md-nav__link">
    <span class="md-ellipsis">
      find_start_activities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.get_sample_case" class="md-nav__link">
    <span class="md-ellipsis">
      get_sample_case
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.import_event_log" class="md-nav__link">
    <span class="md-ellipsis">
      import_event_log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.import_event_log_csv" class="md-nav__link">
    <span class="md-ellipsis">
      import_event_log_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.import_event_log_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      import_event_log_dataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.import_event_log_xes" class="md-nav__link">
    <span class="md-ellipsis">
      import_event_log_xes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.split_train_test" class="md-nav__link">
    <span class="md-ellipsis">
      split_train_test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.string_to_index" class="md-nav__link">
    <span class="md-ellipsis">
      string_to_index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../server_routes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    server routes
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server.preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      preprocessing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.add_unique_start_end_activity" class="md-nav__link">
    <span class="md-ellipsis">
      add_unique_start_end_activity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.encode_df_columns" class="md-nav__link">
    <span class="md-ellipsis">
      encode_df_columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.find_end_activities" class="md-nav__link">
    <span class="md-ellipsis">
      find_end_activities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.find_start_activities" class="md-nav__link">
    <span class="md-ellipsis">
      find_start_activities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.get_sample_case" class="md-nav__link">
    <span class="md-ellipsis">
      get_sample_case
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.import_event_log" class="md-nav__link">
    <span class="md-ellipsis">
      import_event_log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.import_event_log_csv" class="md-nav__link">
    <span class="md-ellipsis">
      import_event_log_csv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.import_event_log_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      import_event_log_dataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.import_event_log_xes" class="md-nav__link">
    <span class="md-ellipsis">
      import_event_log_xes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.split_train_test" class="md-nav__link">
    <span class="md-ellipsis">
      split_train_test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server.preprocessing.Preprocessing.string_to_index" class="md-nav__link">
    <span class="md-ellipsis">
      string_to_index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="preprocessing">Preprocessing</h1>


<div class="doc doc-object doc-module">



<a id="server.preprocessing"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="server.preprocessing.Preprocessing" class="doc doc-heading">
          <code>Preprocessing</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>This is the preprocessing unit for our server. Provided functionality:
- adapter for train_split_test: split the event log's data into testing and training data in the right format
- adapters for importing event logs: make sure the right format is used for the RNN
- TODO: might be extended</p>

            <details class="quote">
              <summary>Source code in <code>server/preprocessing.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Preprocessing</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the preprocessing unit for our server. Provided functionality:</span>
<span class="sd">    - adapter for train_split_test: split the event log&#39;s data into testing and training data in the right format</span>
<span class="sd">    - adapters for importing event logs: make sure the right format is used for the RNN</span>
<span class="sd">    - TODO: might be extended</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#: contains the event log path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_log_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_classes</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolute_frequency_distribution</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_le</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activity_le</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># TODO: invoke import_event_log? (decide)</span>


    <span class="k">def</span> <span class="nf">handle_import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">is_xes</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">activity</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_xes</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">import_event_log_xes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">import_event_log_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">xes_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span> 
        <span class="n">log</span> <span class="o">=</span><span class="n">pm4py</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">read_xes</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">convert_to_dataframe</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done loading&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_event_log_xes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param path: path where the xes file is found</span>
<span class="sd">        :param case_id: column name for the case id column.</span>
<span class="sd">        :param activity_key: column name for the marker column </span>
<span class="sd">        :param timestamp_key: column name for the timestamp column</span>
<span class="sd">        effects:  </span>
<span class="sd">        - event_df dataframe is generated. </span>
<span class="sd">        - the generated dataframe has 3 columns two of type string (case id, label) and one of type</span>
<span class="sd">        datatime64.</span>
<span class="sd">        - event log object: its correctnes is assumed from the pm4py lib and is therefore not tested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">read_xes</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">convert_to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_event_log</span><span class="p">(</span><span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_event_log_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this is an adapter for format_dataframe such that </span>
<span class="sd">        the event data can be properly used by the rnn model. </span>

<span class="sd">        :param path: path to the event log</span>
<span class="sd">        :param case_id: case id column name</span>
<span class="sd">        :param activity_key: activity column name</span>
<span class="sd">        :param timestamp_key: timestamp column name</span>
<span class="sd">        :param sep: separator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_event_log</span><span class="p">(</span><span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_event_log_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span>  <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this is an adapter for format_dataframe such that </span>
<span class="sd">        the event data can be properly used by the rnn model. </span>

<span class="sd">        :param path: path to the event log</span>
<span class="sd">        :param case_id: case id column name</span>
<span class="sd">        :param activity_key: activity column name</span>
<span class="sd">        :param timestamp_key: timestamp column name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_event_log</span><span class="p">(</span><span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">import_event_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        helper function for import_event_log_csv and import_event_log_xes. </span>
<span class="sd">        - genereates an EventLog object so that other pm4py functions can use it</span>
<span class="sd">        - remove all columns other than the three main ones</span>
<span class="sd">        - remove all NaN entries</span>
<span class="sd">        - format a dataframe using pm4py </span>
<span class="sd">        effects: </span>
<span class="sd">        - rows sorted by case id and timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span> <span class="o">=</span>  <span class="n">case_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span> <span class="o">=</span> <span class="n">activity_key</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span> <span class="o">=</span> <span class="n">timestamp_key</span> 
        <span class="c1">#: returns a formated dataframe that can work with other pm4py functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">format_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">,</span> 
                                           <span class="n">case_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span>
                                             <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
                                             <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">)</span> <span class="c1">#returns formated df.</span>



        <span class="c1">#: convert_to_event_log requires string format for case_id and marker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns, UTC]&quot;</span><span class="p">)</span>




        <span class="bp">self</span><span class="o">.</span><span class="n">event_log</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">convert_to_event_log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">)</span> <span class="c1">#this returns an event log</span>


        <span class="c1">#: add unique start/end _activity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_unique_start_end_activity</span><span class="p">()</span>

        <span class="c1">#: filter out all the other generated columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

        <span class="c1">#: sort the rows by group id and timestamp key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">case_id</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">])</span>

        <span class="n">logger_import_event_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encode_df_columns</span><span class="p">()</span>



    <span class="k">def</span> <span class="nf">string_to_index</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        translate each marker into a specific integer index.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">uniques</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">enume</span> <span class="o">=</span> <span class="p">[(</span><span class="n">label</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniques</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">enume</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">encode_df_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        - encode the markers and case id&#39;s with integers (label encoding)</span>
<span class="sd">        - encode the timestamps</span>
<span class="sd">        - returns nothing, but modifies self.event_df</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: we encode the markers with integers (label encoding) to be consistent with the authors implementation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activity_le</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_le</span><span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">(),</span> <span class="n">LabelEncoder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">])</span>

        <span class="c1">#: get the number of classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> 
        <span class="c1">#: trasnform back into strings, its necessary for pm4py</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>

        <span class="c1">#: compute abs. freq. distribution for the activities. its necessary for CrossEntropyLoss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolute_frequency_distribution</span><span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

        <span class="c1"># remove timezone information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1">#: here we convert the datetime64 (ISO standard) into an integer in POSIX standard. the authors</span>
        <span class="c1"># use an Excel format, but we decide to use integers for simplicity.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1">#: generates an integer in posix standard. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">exponent</span><span class="p">)</span>


        <span class="c1"># #: transform the case id and markers back into float</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">split_train_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_percentage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a helper function for splitting the event log into training and testing data.</span>
<span class="sd">        The code is based on the pm4py ml.split_train_test function, but contains only the implementation for pd.dataframes.</span>
<span class="sd">        We don&#39;t use the pm4py implementation because it requires the timestamp to be in datetime format, which is not the case for our implementation.</span>

<span class="sd">        :param train_percentage: what percentage should be used for training</span>
<span class="sd">        :returns: two event logs, one for training and one for training (dataframes). the number of classes (for the markers) also returned. the absolute</span>
<span class="sd">        frequence distribution for each class in the whole event log. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">train_percentage</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">train_percentage</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="n">TrainPercentageTooHigh</span><span class="p">()</span>

        <span class="n">cases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">train_cases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">test_cases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">train_percentage</span><span class="p">:</span>
                <span class="n">train_cases</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">test_cases</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_cases</span><span class="p">)]</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test_cases</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="n">TrainPercentageTooHigh</span><span class="p">()</span>


        <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>



    <span class="k">def</span> <span class="nf">find_start_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        find the start activities of all cases for an existing log and return a dict with start activities as keys and value is the count of this activity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_activities</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get_start_activities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="p">,</span> <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> <span class="n">case_id_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">start_activities</span>

    <span class="k">def</span> <span class="nf">find_end_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        find the end activities of all cases for an existing log and return a dict with end activities as keys and value is the count of this activity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">end_activities</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">get_end_activities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="p">,</span> <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> <span class="n">case_id_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">)</span>
        <span class="n">activities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">end_activity_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">activity</span><span class="p">:</span><span class="kc">False</span>  <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
            <span class="n">end_activity_lookup</span><span class="p">[</span><span class="n">activity</span><span class="p">]</span><span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">end_activity_lookup</span> 

    <span class="k">def</span> <span class="nf">add_unique_start_end_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if there is no unique start/ end activity, add an artificial start and end activity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_start_activities</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_end_activities</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">processed_log</span><span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">insert_artificial_start_end</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="p">,</span> 
                <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> 
                <span class="n">case_id_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> 
                <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span><span class="n">pm4py</span><span class="o">.</span><span class="n">convert_to_dataframe</span><span class="p">(</span><span class="n">processed_log</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">get_sample_case</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns a sample of a case</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sampled_dataframe</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">sample_cases</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">case_id_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sampled_dataframe</span>



    <span class="k">def</span> <span class="nf">prepare_train_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">set_training_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">check_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.add_unique_start_end_activity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_unique_start_end_activity</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>if there is no unique start/ end activity, add an artificial start and end activity</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_unique_start_end_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    if there is no unique start/ end activity, add an artificial start and end activity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_start_activities</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_end_activities</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">processed_log</span><span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">insert_artificial_start_end</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="p">,</span> 
            <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> 
            <span class="n">case_id_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> 
            <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span><span class="n">pm4py</span><span class="o">.</span><span class="n">convert_to_dataframe</span><span class="p">(</span><span class="n">processed_log</span><span class="p">)</span> 
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.encode_df_columns" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">encode_df_columns</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <ul>
<li>encode the markers and case id's with integers (label encoding)</li>
<li>encode the timestamps</li>
<li>returns nothing, but modifies self.event_df</li>
</ul>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">encode_df_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - encode the markers and case id&#39;s with integers (label encoding)</span>
<span class="sd">    - encode the timestamps</span>
<span class="sd">    - returns nothing, but modifies self.event_df</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: we encode the markers with integers (label encoding) to be consistent with the authors implementation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">activity_le</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_le</span><span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">(),</span> <span class="n">LabelEncoder</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">])</span>

    <span class="c1">#: get the number of classes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> 
    <span class="c1">#: trasnform back into strings, its necessary for pm4py</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>

    <span class="c1">#: compute abs. freq. distribution for the activities. its necessary for CrossEntropyLoss</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">absolute_frequency_distribution</span><span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

    <span class="c1"># remove timezone information</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1">#: here we convert the datetime64 (ISO standard) into an integer in POSIX standard. the authors</span>
    <span class="c1"># use an Excel format, but we decide to use integers for simplicity.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1">#: generates an integer in posix standard. </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">exponent</span><span class="p">)</span>


    <span class="c1"># #: transform the case id and markers back into float</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.find_end_activities" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">find_end_activities</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>"
find the end activities of all cases for an existing log and return a dict with end activities as keys and value is the count of this activity</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_end_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">    find the end activities of all cases for an existing log and return a dict with end activities as keys and value is the count of this activity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">end_activities</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">get_end_activities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="p">,</span> <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> <span class="n">case_id_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">)</span>
    <span class="n">activities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">end_activity_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">activity</span><span class="p">:</span><span class="kc">False</span>  <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
        <span class="n">end_activity_lookup</span><span class="p">[</span><span class="n">activity</span><span class="p">]</span><span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">end_activity_lookup</span> 
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.find_start_activities" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">find_start_activities</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>find the start activities of all cases for an existing log and return a dict with start activities as keys and value is the count of this activity</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_start_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    find the start activities of all cases for an existing log and return a dict with start activities as keys and value is the count of this activity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_activities</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get_start_activities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="p">,</span> <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> <span class="n">case_id_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">start_activities</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.get_sample_case" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_sample_case</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>returns a sample of a case</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_sample_case</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    returns a sample of a case</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sampled_dataframe</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">sample_cases</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_log</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">case_id_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sampled_dataframe</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.import_event_log" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">import_event_log</span><span class="p">(</span><span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>helper function for import_event_log_csv and import_event_log_xes. 
- genereates an EventLog object so that other pm4py functions can use it
- remove all columns other than the three main ones
- remove all NaN entries
- format a dataframe using pm4py 
effects: 
- rows sorted by case id and timestamp</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">import_event_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper function for import_event_log_csv and import_event_log_xes. </span>
<span class="sd">    - genereates an EventLog object so that other pm4py functions can use it</span>
<span class="sd">    - remove all columns other than the three main ones</span>
<span class="sd">    - remove all NaN entries</span>
<span class="sd">    - format a dataframe using pm4py </span>
<span class="sd">    effects: </span>
<span class="sd">    - rows sorted by case id and timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span> <span class="o">=</span>  <span class="n">case_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span> <span class="o">=</span> <span class="n">activity_key</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span> <span class="o">=</span> <span class="n">timestamp_key</span> 
    <span class="c1">#: returns a formated dataframe that can work with other pm4py functions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">format_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">,</span> 
                                       <span class="n">case_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span>
                                         <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
                                         <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">)</span> <span class="c1">#returns formated df.</span>



    <span class="c1">#: convert_to_event_log requires string format for case_id and marker</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns, UTC]&quot;</span><span class="p">)</span>




    <span class="bp">self</span><span class="o">.</span><span class="n">event_log</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">convert_to_event_log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">)</span> <span class="c1">#this returns an event log</span>


    <span class="c1">#: add unique start/end _activity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_unique_start_end_activity</span><span class="p">()</span>

    <span class="c1">#: filter out all the other generated columns</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1">#: sort the rows by group id and timestamp key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">case_id</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">])</span>

    <span class="n">logger_import_event_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">encode_df_columns</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.import_event_log_csv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">import_event_log_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>this is an adapter for format_dataframe such that 
the event data can be properly used by the rnn model. </p>
<p>:param path: path to the event log
:param case_id: case id column name
:param activity_key: activity column name
:param timestamp_key: timestamp column name
:param sep: separator</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">import_event_log_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this is an adapter for format_dataframe such that </span>
<span class="sd">    the event data can be properly used by the rnn model. </span>

<span class="sd">    :param path: path to the event log</span>
<span class="sd">    :param case_id: case id column name</span>
<span class="sd">    :param activity_key: activity column name</span>
<span class="sd">    :param timestamp_key: timestamp column name</span>
<span class="sd">    :param sep: separator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_event_log</span><span class="p">(</span><span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.import_event_log_dataframe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">import_event_log_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>this is an adapter for format_dataframe such that 
the event data can be properly used by the rnn model. </p>
<p>:param path: path to the event log
:param case_id: case id column name
:param activity_key: activity column name
:param timestamp_key: timestamp column name</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">import_event_log_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span>  <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this is an adapter for format_dataframe such that </span>
<span class="sd">    the event data can be properly used by the rnn model. </span>

<span class="sd">    :param path: path to the event log</span>
<span class="sd">    :param case_id: case id column name</span>
<span class="sd">    :param activity_key: activity column name</span>
<span class="sd">    :param timestamp_key: timestamp column name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="n">df</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_event_log</span><span class="p">(</span><span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.import_event_log_xes" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">import_event_log_xes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>:param path: path where the xes file is found
:param case_id: column name for the case id column.
:param activity_key: column name for the marker column 
:param timestamp_key: column name for the timestamp column
effects:<br />
- event_df dataframe is generated. 
- the generated dataframe has 3 columns two of type string (case id, label) and one of type
datatime64.
- event log object: its correctnes is assumed from the pm4py lib and is therefore not tested</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">import_event_log_xes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param path: path where the xes file is found</span>
<span class="sd">    :param case_id: column name for the case id column.</span>
<span class="sd">    :param activity_key: column name for the marker column </span>
<span class="sd">    :param timestamp_key: column name for the timestamp column</span>
<span class="sd">    effects:  </span>
<span class="sd">    - event_df dataframe is generated. </span>
<span class="sd">    - the generated dataframe has 3 columns two of type string (case id, label) and one of type</span>
<span class="sd">    datatime64.</span>
<span class="sd">    - event log object: its correctnes is assumed from the pm4py lib and is therefore not tested</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">read_xes</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">convert_to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_event_log</span><span class="p">(</span><span class="n">case_id</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.split_train_test" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">split_train_test</span><span class="p">(</span><span class="n">train_percentage</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This is a helper function for splitting the event log into training and testing data.
The code is based on the pm4py ml.split_train_test function, but contains only the implementation for pd.dataframes.
We don't use the pm4py implementation because it requires the timestamp to be in datetime format, which is not the case for our implementation.</p>
<p>:param train_percentage: what percentage should be used for training
:returns: two event logs, one for training and one for training (dataframes). the number of classes (for the markers) also returned. the absolute
frequence distribution for each class in the whole event log.</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_train_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_percentage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a helper function for splitting the event log into training and testing data.</span>
<span class="sd">    The code is based on the pm4py ml.split_train_test function, but contains only the implementation for pd.dataframes.</span>
<span class="sd">    We don&#39;t use the pm4py implementation because it requires the timestamp to be in datetime format, which is not the case for our implementation.</span>

<span class="sd">    :param train_percentage: what percentage should be used for training</span>
<span class="sd">    :returns: two event logs, one for training and one for training (dataframes). the number of classes (for the markers) also returned. the absolute</span>
<span class="sd">    frequence distribution for each class in the whole event log. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">train_percentage</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">train_percentage</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span> 
        <span class="k">raise</span> <span class="n">TrainPercentageTooHigh</span><span class="p">()</span>

    <span class="n">cases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">train_cases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">test_cases</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">train_percentage</span><span class="p">:</span>
            <span class="n">train_cases</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">test_cases</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_cases</span><span class="p">)]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test_cases</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        <span class="k">raise</span> <span class="n">TrainPercentageTooHigh</span><span class="p">()</span>


    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.preprocessing.Preprocessing.string_to_index" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">string_to_index</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>translate each marker into a specific integer index.</p>

          <details class="quote">
            <summary>Source code in <code>server/preprocessing.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">string_to_index</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    translate each marker into a specific integer index.  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">uniques</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">enume</span> <span class="o">=</span> <span class="p">[(</span><span class="n">label</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniques</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">enume</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><h1 id="nn-manager">NN Manager</h1>


<div class="doc doc-object doc-module">



<a id="server.nn_manager"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="server.nn_manager.NNManagement" class="doc doc-heading">
          <code>NNManagement</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>This is the NNMamangement class. Provided functinality: 
- train the model based on the event log. 
- test the model based on the event log.
- set params. 
- TODO: might be extended</p>

            <details class="quote">
              <summary>Source code in <code>server/nn_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NNManagement</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the NNMamangement class. Provided functinality: </span>
<span class="sd">    - train the model based on the event log. </span>
<span class="sd">    - test the model based on the event log.</span>
<span class="sd">    - set params. </span>
<span class="sd">    - TODO: might be extended </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span> <span class="k">if</span> <span class="n">config</span> <span class="o">==</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_error</span> <span class="o">=</span> <span class="kc">None</span>



    <span class="k">def</span> <span class="nf">set_training_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used for setting the training parameters. Note that not all params must be input.</span>

<span class="sd">        :param seq_length: --seq_len determines the &quot;b&quot; constant that was defined in the paper (see 5.2 parameter learning)</span>
<span class="sd">        determines a window size to save the training sequences into in a tensor. </span>
<span class="sd">        :param emb_dim: embedding dimension </span>
<span class="sd">        :param hid_dim: --hid_dim dimension for the hidden dimension </span>
<span class="sd">        :param mlp_dim: --mlp_dim dimension for the mlp (LSTM) TODO: revise</span>
<span class="sd">        :param alpha: --alpha=0.05 </span>
<span class="sd">        :param dropout: dropout parameter (RNN)</span>
<span class="sd">        :param batch_size: batch size</span>
<span class="sd">        :param lr: learning rate</span>
<span class="sd">        :param epochs: no of epochs</span>
<span class="sd">        :param train_time_limit: time limit for training in minutes, when the time is over training will be aborted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seq_len&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emb_dim</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;emb_dim&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">hid_dim</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hid_dim&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mlp_dim</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mlp_dim&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dropout&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_size&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lr&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;epochs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">importance_weight</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;importance_weight&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose_step&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">train_time_limit</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;train_time_limit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this is the testing function for the model. </span>
<span class="sd">        it prints out the time_error, precision, recall and f1 score.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: main testing function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">pred_times</span><span class="p">,</span> <span class="n">pred_events</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1">#inputs/training data</span>
        <span class="n">gold_times</span><span class="p">,</span> <span class="n">gold_events</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1">#targets</span>


        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_loader</span><span class="p">)):</span>
            <span class="c1">#batch: pair with two tensors, each containing respectively the time and event data.  </span>
            <span class="n">gold_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span> <span class="c1"># extract for each sequence the last time stamp/ the last event</span>
            <span class="n">gold_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
            <span class="n">pred_time</span><span class="p">,</span> <span class="n">pred_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
            <span class="n">pred_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_time</span><span class="p">)</span>
            <span class="n">pred_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_event</span><span class="p">)</span>



        <span class="n">pred_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">pred_times</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gold_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">gold_times</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pred_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">pred_events</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gold_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">gold_events</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_error</span> <span class="o">=</span> <span class="n">abs_error</span><span class="p">(</span><span class="n">pred_times</span><span class="p">,</span> <span class="n">gold_times</span><span class="p">)</span>  <span class="c1">#compute errors</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">=</span> <span class="n">clf_metric</span><span class="p">(</span><span class="n">pred_events</span><span class="p">,</span> <span class="n">gold_events</span><span class="p">,</span> <span class="n">n_class</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">number_classes</span><span class="p">)</span> <span class="c1">#get the metrics</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;time_error: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_error</span><span class="si">}</span><span class="s2">, PRECISION: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="si">}</span><span class="s2">, RECALL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="si">}</span><span class="s2">, F1: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_training_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the accuracy, recall and f1 score </span>
<span class="sd">        as a json object in string format. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">==</span><span class="kc">None</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="n">ModelNotTrainedYet</span><span class="p">()</span>

        <span class="c1">#: dumps generates a string</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;acc&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">,</span> 
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">,</span>
            <span class="s2">&quot;f1&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">f1</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">import_nn_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        imports a .pt file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">saved_model_contents</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">saved_model_contents</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
        <span class="n">lossweight</span> <span class="o">=</span> <span class="n">saved_model_contents</span><span class="p">[</span><span class="s1">&#39;lossweight&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lossweight</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">saved_model_contents</span><span class="p">[</span><span class="s1">&#39;model_state_dict&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">saved_model_contents</span><span class="p">[</span><span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span> <span class="c1"># relevant for droput layers.</span>


    <span class="k">def</span> <span class="nf">export_nn_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generates the .pt file containing the generated</span>
<span class="sd">        model. </span>

<span class="sd">        model state dict contains</span>
<span class="sd">        optimizer state dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">({</span>
            <span class="s1">&#39;model_state_dict&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
            <span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
            <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> 
            <span class="s1">&#39;lossweight&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lossweight</span>
        <span class="p">},</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">random_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="p">,</span>  <span class="n">search_parameters</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">case_id_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">case_activity_key</span> <span class="p">):</span> 
        <span class="n">acc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">case_id_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">case_activity_key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span> 
            <span class="n">a</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;hidden_dim&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;hidden_dim&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">b</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;lstm_dim&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;lstm_dim&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">c</span><span class="o">=</span>  <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;emb_dim&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;emb_dim&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">hid_dim</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emb_dim</span><span class="o">=</span> <span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mlp_dim</span><span class="o">=</span><span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="o">&gt;</span> <span class="n">acc</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">hid_dim</span> <span class="o">=</span> <span class="n">a</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emb_dim</span><span class="o">=</span> <span class="n">b</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mlp_dim</span><span class="o">=</span><span class="n">c</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span>
                <span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">best_model</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">grid_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="p">,</span>  <span class="n">search_parameters</span><span class="p">,</span> <span class="n">case_id_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">case_activity_key</span> <span class="p">):</span> 
        <span class="n">acc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">case_id_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">case_activity_key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;hidden_dim&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;hidden_dim&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;hidden_dim&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">hid_dim</span> <span class="o">=</span><span class="n">i</span> 
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;lstm_dim&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;lstm_dim&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;lstm_dim&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mlp_dim</span><span class="o">=</span><span class="n">j</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;emb_dim&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;emb_dim&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">search_parameters</span><span class="p">[</span><span class="s2">&quot;emb_dim&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emb_dim</span><span class="o">=</span><span class="n">k</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">our_implementation</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
                        <span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="o">&gt;</span> <span class="n">acc</span><span class="p">:</span> 
                            <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">best_model</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best acc: </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">event_key</span> <span class="p">):</span>
        <span class="n">train_set</span> <span class="o">=</span> <span class="n">ATMDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="p">,</span><span class="n">train_data</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span>   <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">event_key</span> <span class="p">)</span> 
        <span class="n">test_set</span> <span class="o">=</span> <span class="n">ATMDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">case_id</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">event_key</span><span class="p">)</span>
        <span class="c1"># now load the data to torch tensors and generate the batches. also </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">ATMDataset</span><span class="o">.</span><span class="n">to_features</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">ATMDataset</span><span class="o">.</span><span class="n">to_features</span><span class="p">)</span>

        <span class="c1">#: initialize a matrix to store the importance weights</span>
        <span class="c1"># that will be passed to the CrossEntropyLoss object. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_classes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">importance_weight</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">train_set</span><span class="o">.</span><span class="n">importance_weight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">absolute_frequency_distribution</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the main training function </span>
<span class="sd">        :param train_data: train data df</span>
<span class="sd">        :param test_data: test data df  </span>
<span class="sd">        :param case_id: case id column name in the df</span>
<span class="sd">        :param timestampt_key: timestamp key in the df</span>
<span class="sd">        :param no_classes: number of known markers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we already pass the split data to de ATM loader. ATMDAtaset uses the sliding window for generating the input for training.</span>
        <span class="c1"># since we are using tensors for training the sequence length remains fixed in each epoch, hence we cannot do &quot;arbitrary length cuts&quot; </span>
        <span class="c1"># to the training data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">lossweight</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span> <span class="c1">#crete a NN instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_optimizer</span><span class="p">(</span><span class="n">total_step</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_loader</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epochs</span><span class="p">)</span> <span class="c1">#TODO: fix use bert (doesnt exist)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span> <span class="c1">#GPU </span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">epc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epochs</span><span class="p">):</span> <span class="c1">#do the epochs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>  
            <span class="n">range_loss1</span> <span class="o">=</span> <span class="n">range_loss2</span> <span class="o">=</span> <span class="n">range_loss</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_loader</span><span class="p">)):</span>

                <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> 
                <span class="n">range_loss1</span> <span class="o">+=</span> <span class="n">l1</span>
                <span class="n">range_loss2</span> <span class="o">+=</span> <span class="n">l2</span>
                <span class="n">range_loss</span> <span class="o">+=</span> <span class="n">l</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time loss: &quot;</span><span class="p">,</span> <span class="n">range_loss1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;event loss:&quot;</span><span class="p">,</span> <span class="n">range_loss2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;total loss:&quot;</span><span class="p">,</span> <span class="n">range_loss</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span><span class="p">)</span>
                    <span class="n">range_loss1</span> <span class="o">=</span> <span class="n">range_loss2</span> <span class="o">=</span> <span class="n">range_loss</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># check if the training time limit is exceeded</span>
                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">train_time_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">train_time_limit</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">TrainTimeLimitExceeded</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="server.nn_manager.NNManagement.evaluate" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>this is the testing function for the model. 
it prints out the time_error, precision, recall and f1 score.</p>

          <details class="quote">
            <summary>Source code in <code>server/nn_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this is the testing function for the model. </span>
<span class="sd">    it prints out the time_error, precision, recall and f1 score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: main testing function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">pred_times</span><span class="p">,</span> <span class="n">pred_events</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1">#inputs/training data</span>
    <span class="n">gold_times</span><span class="p">,</span> <span class="n">gold_events</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1">#targets</span>


    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_loader</span><span class="p">)):</span>
        <span class="c1">#batch: pair with two tensors, each containing respectively the time and event data.  </span>
        <span class="n">gold_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span> <span class="c1"># extract for each sequence the last time stamp/ the last event</span>
        <span class="n">gold_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">pred_time</span><span class="p">,</span> <span class="n">pred_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">pred_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_time</span><span class="p">)</span>
        <span class="n">pred_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_event</span><span class="p">)</span>



    <span class="n">pred_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">pred_times</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gold_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">gold_times</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pred_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">pred_events</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gold_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">gold_events</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_error</span> <span class="o">=</span> <span class="n">abs_error</span><span class="p">(</span><span class="n">pred_times</span><span class="p">,</span> <span class="n">gold_times</span><span class="p">)</span>  <span class="c1">#compute errors</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">=</span> <span class="n">clf_metric</span><span class="p">(</span><span class="n">pred_events</span><span class="p">,</span> <span class="n">gold_events</span><span class="p">,</span> <span class="n">n_class</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">number_classes</span><span class="p">)</span> <span class="c1">#get the metrics</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;time_error: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_error</span><span class="si">}</span><span class="s2">, PRECISION: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="si">}</span><span class="s2">, RECALL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="si">}</span><span class="s2">, F1: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.nn_manager.NNManagement.export_nn_model" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">export_nn_model</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>generates the .pt file containing the generated
model. </p>
<p>model state dict contains
optimizer state dict</p>

          <details class="quote">
            <summary>Source code in <code>server/nn_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_nn_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    generates the .pt file containing the generated</span>
<span class="sd">    model. </span>

<span class="sd">    model state dict contains</span>
<span class="sd">    optimizer state dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">({</span>
        <span class="s1">&#39;model_state_dict&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
        <span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
        <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> 
        <span class="s1">&#39;lossweight&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lossweight</span>
    <span class="p">},</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.nn_manager.NNManagement.get_training_statistics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_training_statistics</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>:return: the accuracy, recall and f1 score 
as a json object in string format.</p>

          <details class="quote">
            <summary>Source code in <code>server/nn_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_training_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :return: the accuracy, recall and f1 score </span>
<span class="sd">    as a json object in string format. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">==</span><span class="kc">None</span><span class="p">:</span> 
        <span class="k">raise</span> <span class="n">ModelNotTrainedYet</span><span class="p">()</span>

    <span class="c1">#: dumps generates a string</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;acc&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">,</span> 
        <span class="s2">&quot;recall&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">,</span>
        <span class="s2">&quot;f1&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">f1</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.nn_manager.NNManagement.import_nn_model" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">import_nn_model</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>imports a .pt file</p>

          <details class="quote">
            <summary>Source code in <code>server/nn_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">import_nn_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    imports a .pt file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">saved_model_contents</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">saved_model_contents</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
    <span class="n">lossweight</span> <span class="o">=</span> <span class="n">saved_model_contents</span><span class="p">[</span><span class="s1">&#39;lossweight&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lossweight</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">saved_model_contents</span><span class="p">[</span><span class="s1">&#39;model_state_dict&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">saved_model_contents</span><span class="p">[</span><span class="s1">&#39;optimizer_state_dict&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span> <span class="c1"># relevant for droput layers.</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.nn_manager.NNManagement.set_training_parameters" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_training_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Used for setting the training parameters. Note that not all params must be input.</p>
<p>:param seq_length: --seq_len determines the "b" constant that was defined in the paper (see 5.2 parameter learning)
determines a window size to save the training sequences into in a tensor. 
:param emb_dim: embedding dimension 
:param hid_dim: --hid_dim dimension for the hidden dimension 
:param mlp_dim: --mlp_dim dimension for the mlp (LSTM) TODO: revise
:param alpha: --alpha=0.05 
:param dropout: dropout parameter (RNN)
:param batch_size: batch size
:param lr: learning rate
:param epochs: no of epochs
:param train_time_limit: time limit for training in minutes, when the time is over training will be aborted</p>

          <details class="quote">
            <summary>Source code in <code>server/nn_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_training_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used for setting the training parameters. Note that not all params must be input.</span>

<span class="sd">    :param seq_length: --seq_len determines the &quot;b&quot; constant that was defined in the paper (see 5.2 parameter learning)</span>
<span class="sd">    determines a window size to save the training sequences into in a tensor. </span>
<span class="sd">    :param emb_dim: embedding dimension </span>
<span class="sd">    :param hid_dim: --hid_dim dimension for the hidden dimension </span>
<span class="sd">    :param mlp_dim: --mlp_dim dimension for the mlp (LSTM) TODO: revise</span>
<span class="sd">    :param alpha: --alpha=0.05 </span>
<span class="sd">    :param dropout: dropout parameter (RNN)</span>
<span class="sd">    :param batch_size: batch size</span>
<span class="sd">    :param lr: learning rate</span>
<span class="sd">    :param epochs: no of epochs</span>
<span class="sd">    :param train_time_limit: time limit for training in minutes, when the time is over training will be aborted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seq_len&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emb_dim</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;emb_dim&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">hid_dim</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hid_dim&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mlp_dim</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mlp_dim&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dropout&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_size&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lr&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;epochs&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">importance_weight</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;importance_weight&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose_step&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">train_time_limit</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;train_time_limit&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.nn_manager.NNManagement.train" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">train</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This is the main training function 
:param train_data: train data df
:param test_data: test data df<br />
:param case_id: case id column name in the df
:param timestampt_key: timestamp key in the df
:param no_classes: number of known markers.</p>

          <details class="quote">
            <summary>Source code in <code>server/nn_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the main training function </span>
<span class="sd">    :param train_data: train data df</span>
<span class="sd">    :param test_data: test data df  </span>
<span class="sd">    :param case_id: case id column name in the df</span>
<span class="sd">    :param timestampt_key: timestamp key in the df</span>
<span class="sd">    :param no_classes: number of known markers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># we already pass the split data to de ATM loader. ATMDAtaset uses the sliding window for generating the input for training.</span>
    <span class="c1"># since we are using tensors for training the sequence length remains fixed in each epoch, hence we cannot do &quot;arbitrary length cuts&quot; </span>
    <span class="c1"># to the training data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Net</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">lossweight</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span> <span class="c1">#crete a NN instance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_optimizer</span><span class="p">(</span><span class="n">total_step</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_loader</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epochs</span><span class="p">)</span> <span class="c1">#TODO: fix use bert (doesnt exist)</span>


    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span> <span class="c1">#GPU </span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">epc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">epochs</span><span class="p">):</span> <span class="c1">#do the epochs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>  
        <span class="n">range_loss1</span> <span class="o">=</span> <span class="n">range_loss2</span> <span class="o">=</span> <span class="n">range_loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_loader</span><span class="p">)):</span>

            <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> 
            <span class="n">range_loss1</span> <span class="o">+=</span> <span class="n">l1</span>
            <span class="n">range_loss2</span> <span class="o">+=</span> <span class="n">l2</span>
            <span class="n">range_loss</span> <span class="o">+=</span> <span class="n">l</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time loss: &quot;</span><span class="p">,</span> <span class="n">range_loss1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;event loss:&quot;</span><span class="p">,</span> <span class="n">range_loss2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;total loss:&quot;</span><span class="p">,</span> <span class="n">range_loss</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">verbose_step</span><span class="p">)</span>
                <span class="n">range_loss1</span> <span class="o">=</span> <span class="n">range_loss2</span> <span class="o">=</span> <span class="n">range_loss</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># check if the training time limit is exceeded</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">train_time_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">train_time_limit</span> <span class="o">*</span> <span class="mi">60</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TrainTimeLimitExceeded</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><h1 id="prediction-manager">Prediction Manager</h1>


<div class="doc doc-object doc-module">



<a id="server.prediction_manager"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="server.prediction_manager.PredictionManager" class="doc doc-heading">
          <code>PredictionManager</code>


</h2>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>server/prediction_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PredictionManager</span><span class="p">:</span> 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">case_id_key</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">config</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param model: the model used for doing predictions</span>
<span class="sd">        :param case_id_key: case id key of the log </span>
<span class="sd">        :param activity_key: activity key of the log</span>
<span class="sd">        :param timestamp_key: timestamp key of the log</span>
<span class="sd">        :param config: configuration used for training and important hyperparams.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span><span class="n">model</span>  <span class="c1">#: we assume there is an already existing model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span> <span class="o">=</span> <span class="n">case_id_key</span> <span class="c1"># we assume the three important columns are known</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span> <span class="o">=</span> <span class="n">activity_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span> <span class="o">=</span> <span class="n">timestamp_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_case_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoded_paths</span><span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_activities</span><span class="o">=</span> <span class="p">{}</span>





    <span class="k">def</span> <span class="nf">get_dummy_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">case_id_column</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        just used for testing; create a dummy input df.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">random_case_id</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">case_id_column</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">case_id_column</span><span class="p">]</span><span class="o">==</span><span class="n">random_case_id</span><span class="p">]</span>
        <span class="n">n_rows</span> <span class="o">=</span> <span class="n">dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">n_rows</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessTooShort</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dummy</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">n_rows</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">check_input_uniqueness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the input df must contain only one process. hence check if thereis one unique case_id </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>


    <span class="k">def</span> <span class="nf">single_prediction_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make one prediction given a dataframe. </span>
<span class="sd">        preprocessor is in charge of doing the</span>
<span class="sd">        reading/importing from csv, xes, commandline, etc...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">Preprocessing</span><span class="p">()</span>
        <span class="n">preprocessor</span><span class="o">.</span><span class="n">import_event_log_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">event_df</span> 

        <span class="c1">#: check case id uniqueness</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input_uniqueness</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotOneCaseId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_case_id</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_prediction</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">single_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make one prediction given a partial process. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#: sliding window</span>
        <span class="n">step1</span><span class="o">=</span> <span class="n">ATMDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">)</span>
        <span class="c1">#: just create one batch</span>
        <span class="n">step2</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">step1</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">step1</span><span class="o">.</span><span class="n">time_seqs</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">ATMDataset</span><span class="o">.</span><span class="n">to_features</span><span class="p">)</span>

        <span class="c1">#: TODO: refactor these lines here. no need for a for loop</span>
        <span class="n">pred_times</span><span class="p">,</span> <span class="n">pred_events</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">step2</span><span class="p">):</span>   
            <span class="n">pred_time</span><span class="p">,</span> <span class="n">pred_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">pm_active</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">pred_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_time</span><span class="p">)</span>
            <span class="n">pred_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_event</span><span class="p">)</span>
        <span class="n">time_pred</span> <span class="o">=</span> <span class="n">pred_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">event_pred</span> <span class="o">=</span> <span class="n">pred_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 

        <span class="k">return</span> <span class="n">time_pred</span><span class="p">,</span>  <span class="n">event_pred</span>

    <span class="k">def</span> <span class="nf">jsonify_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">,</span> <span class="n">event_pred</span><span class="p">,</span> <span class="n">prob</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        note that we just save the</span>
<span class="sd">        probability of the last pair (time, event) in the path, </span>
<span class="sd">        since the nn calculates lambda*(t) (see paper), which is </span>
<span class="sd">        the probability of the last predicted event happening</span>
<span class="sd">        in the predicted time t. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time_pred</span><span class="p">,</span> 
            <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">activity_le</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">event_pred</span><span class="p">),</span>
            <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="n">prob</span>
        <span class="p">}</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">get_differences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculates time differences. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">local</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span><span class="p">:</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">seq</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
            <span class="n">local</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">local</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">append_one_difference_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        appends one difference array to self.recursive_time_diffs </span>
<span class="sd">        :param lst: list use for calculating the contiguous differences. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: extend the list by one element</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span> <span class="n">lst</span><span class="p">)</span>
        <span class="c1">#: get the differrnces between contiguous elements.</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="p">,</span> <span class="p">[</span><span class="n">time</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">multiple_prediction_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">nonstop</span> <span class="p">,</span><span class="n">upper</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this is a special case of multiple prediction</span>
<span class="sd">        where the degree= 1. we avoid backtracking and recursion for</span>
<span class="sd">        efficiency reasons.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: get the event and timestamp of the last event in the partial process.</span>
        <span class="n">c_t</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">c_e</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">#: compute sliding window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">=</span> <span class="n">ATMDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">time_seqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">event_seqs</span>

        <span class="c1">#: compute differences within each window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_differences</span><span class="p">()</span>


        <span class="k">if</span> <span class="n">nonstop</span><span class="p">:</span> 
            <span class="c1">#: in case that we run until end activity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linear_iterative_predictor_non_stop</span><span class="p">(</span><span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#: in case we run until a given depth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linear_iterative_predictor</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">)</span> 

        <span class="c1">#: decode the generated paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_paths</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">linear_iterative_predictor_non_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">start_event</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param start_time: used to mark the start of the path </span>
<span class="sd">        :param start_event: used to mark the start of the path</span>
<span class="sd">        :param upper: upper bound for the amount of iterations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_t</span> <span class="o">=</span> <span class="n">start_time</span>
        <span class="n">c_e</span> <span class="o">=</span> <span class="n">start_event</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c_t</span> <span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c_e</span><span class="p">))]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#TODO: set upper bound as default to INFTY</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_activities</span><span class="p">[</span><span class="n">c_e</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">upper</span><span class="p">:</span> <span class="c1">#stop if end activity found or upper bound crossed</span>
            <span class="n">p_t</span><span class="p">,</span> <span class="n">p_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sorted_wrapper</span><span class="p">()</span> <span class="c1">#get prediction</span>
            <span class="n">p_pair</span> <span class="o">=</span> <span class="n">p_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#get pair (prob, event)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">p_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)))</span> <span class="c1">#save to path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_to_log</span><span class="p">(</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#update log for recusrive call</span>
            <span class="n">c_t</span> <span class="o">=</span> <span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c_e</span> <span class="o">=</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1">#save generated path </span>


    <span class="k">def</span> <span class="nf">linear_iterative_predictor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">start_event</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO: merge this fucntion with linear_iterative_predictor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_t</span> <span class="o">=</span> <span class="n">start_time</span>
        <span class="n">c_e</span> <span class="o">=</span> <span class="n">start_event</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c_t</span> <span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c_e</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span> 
            <span class="n">p_t</span><span class="p">,</span> <span class="n">p_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sorted_wrapper</span><span class="p">()</span>
            <span class="n">p_pair</span> <span class="o">=</span> <span class="n">p_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">p_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_to_log</span><span class="p">(</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">multiple_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get a list of possible paths starting at the last </span>
<span class="sd">        timestamp and event pair.  </span>
<span class="sd">        :param depth: how many steps in the future are to be predicted.</span>
<span class="sd">        :param degree: how many predictions on each step are to be considered.</span>
<span class="sd">        :param config: configuration used for the NN. required by ATM Dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_t</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">c_e</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">#:load data, get windows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">=</span> <span class="n">ATMDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">time_seqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">event_seqs</span>

        <span class="c1">#:get differences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_differences</span><span class="p">()</span>

        <span class="c1">#: compute paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backtracking_prediction_tree</span><span class="p">(</span><span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,[(</span><span class="n">c_t</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c_e</span><span class="p">))])</span> 

        <span class="c1">#: decode paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_paths</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">backtracking_prediction_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">,</span> <span class="n">c_d</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span><span class="n">current_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        use backtracking to generate all the paths from the given </span>
<span class="sd">        last timestamp and marker considering the input degree as a threshold </span>
<span class="sd">        and the maximum depth for the generated tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">c_d</span> <span class="o">&gt;=</span> <span class="n">depth</span><span class="p">:</span> 
            <span class="c1"># base case</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">current_path</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="n">p_t</span><span class="p">,</span> <span class="n">p_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sorted_wrapper</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">p_e</span> <span class="ow">in</span> <span class="n">p_events</span><span class="p">[:</span><span class="n">degree</span><span class="p">]:</span>
            <span class="c1"># filter branching degree ; the list is already sorted</span>
            <span class="c1"># therefore the &quot;degree&quot; most probable are taken</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_to_log</span><span class="p">(</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 
            <span class="n">current_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p_t</span><span class="p">,</span> <span class="n">p_e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backtracking_prediction_tree</span><span class="p">(</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c_d</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_path</span><span class="p">))</span>    
            <span class="n">current_path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_from_log</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_sorted_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1">#: check whether the number of rows in </span>
        <span class="c1"># self.encoded_df &lt;= seq_len. otherwise the</span>
        <span class="c1"># processed data by dataloader/atmdataset </span>
        <span class="c1"># output empty lists... </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span><span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SeqLengthTooHigh</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">event_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">time_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span>


        <span class="c1">#: do not use dataloader for batch genertaion, too inefficient</span>
        <span class="c1">#: differnces are also computed in a smarter way, as well as windows.</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="p">(</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span> 


        <span class="n">pred_times</span><span class="p">,</span> <span class="n">pred_events</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">pred_time</span><span class="p">,</span> <span class="n">pred_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict_sorted</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>

        <span class="n">pred_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_time</span><span class="p">)</span>
        <span class="n">pred_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_event</span><span class="p">)</span>

        <span class="n">pred_times</span><span class="o">=</span> <span class="n">pred_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#we are only interested in the last one; unpack the batch</span>
        <span class="n">pred_events</span> <span class="o">=</span> <span class="n">pred_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">pred_times</span><span class="p">,</span> <span class="n">pred_events</span>


    <span class="k">def</span> <span class="nf">append_to_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        instead of calling ATMDataset and Dataloader on each iterative call </span>
<span class="sd">        of the prediction generator, just append a window and a difference array</span>
<span class="sd">        to an existing list.  </span>
<span class="sd">        :param time: newly predicted timestamp</span>
<span class="sd">        :param event: newly predicted event </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_time_seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">last_event_seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">new_time_seq</span> <span class="o">=</span> <span class="n">last_time_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">new_event_seq</span> <span class="o">=</span> <span class="n">last_event_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">new_time_seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">new_event_seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_time_seq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_event_seq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_one_difference_array</span><span class="p">(</span><span class="n">new_time_seq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop_from_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        used for backtracking to restore the old path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">decode_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        used for decoding the events and timestamps in the generated paths. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#TODO: decode time</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decoded_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span> 
            <span class="n">encoded_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">event_index</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">event_index</span><span class="p">)</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span>
            <span class="n">encoded_events</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">encoded_events</span><span class="p">))</span>
            <span class="n">decoded_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">activity_le</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">encoded_events</span><span class="p">)</span>


            <span class="n">decoded_path</span><span class="o">=</span> <span class="p">[(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">_</span><span class="p">)),</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">decoded_events</span><span class="p">)</span> <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decoded_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decoded_path</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">jsonify_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        note that we just save the</span>
<span class="sd">        probability of the last pair (time, event) in the path, </span>
<span class="sd">        since the nn calculates lambda*(t), which is </span>
<span class="sd">        the probability of the last predicted event happening</span>
<span class="sd">        in the predicted time t. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;paths&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoded_paths</span> <span class="p">:</span>
            <span class="n">current_path</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;pairs&#39;</span><span class="p">:[],</span> 
                <span class="s1">&#39;percentage&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">per</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">current_path</span><span class="p">[</span><span class="s2">&quot;pairs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> 
                        <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">,</span> 
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="n">ans</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">multiple_prediction_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">non_stop</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make multiple predictions given a dataframe</span>
<span class="sd">        preprocessor is in charge of doing the</span>
<span class="sd">        reading/importing from csv, xes, commandline, etc...</span>
<span class="sd">        it is assumed that the event log contains only one case id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">Preprocessing</span><span class="p">()</span>
        <span class="n">preprocessor</span><span class="o">.</span><span class="n">import_event_log_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">event_df</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">current_case_id</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">linear</span><span class="p">:</span> 
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            case backtracking needed </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiple_prediction</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            the linear version is only being used for</span>
<span class="sd">            the iterative use of the multiple prediction generation.</span>
<span class="sd">            it mostly contains optimizations that are only </span>
<span class="sd">            tought for the iterative generation prediction </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multiple_prediction_linear</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">non_stop</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">case_id_key</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>:param model: the model used for doing predictions
:param case_id_key: case id key of the log 
:param activity_key: activity key of the log
:param timestamp_key: timestamp key of the log
:param config: configuration used for training and important hyperparams.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">case_id_key</span><span class="p">,</span> <span class="n">activity_key</span><span class="p">,</span> <span class="n">timestamp_key</span><span class="p">,</span> <span class="n">config</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param model: the model used for doing predictions</span>
<span class="sd">    :param case_id_key: case id key of the log </span>
<span class="sd">    :param activity_key: activity key of the log</span>
<span class="sd">    :param timestamp_key: timestamp key of the log</span>
<span class="sd">    :param config: configuration used for training and important hyperparams.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span><span class="n">model</span>  <span class="c1">#: we assume there is an already existing model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span> <span class="o">=</span> <span class="n">case_id_key</span> <span class="c1"># we assume the three important columns are known</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span> <span class="o">=</span> <span class="n">activity_key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span> <span class="o">=</span> <span class="n">timestamp_key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">current_case_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decoded_paths</span><span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_activities</span><span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.append_one_difference_array" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">append_one_difference_array</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>appends one difference array to self.recursive_time_diffs 
:param lst: list use for calculating the contiguous differences.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">append_one_difference_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    appends one difference array to self.recursive_time_diffs </span>
<span class="sd">    :param lst: list use for calculating the contiguous differences. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: extend the list by one element</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span> <span class="n">lst</span><span class="p">)</span>
    <span class="c1">#: get the differrnces between contiguous elements.</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="p">,</span> <span class="p">[</span><span class="n">time</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.append_to_log" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">append_to_log</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>instead of calling ATMDataset and Dataloader on each iterative call 
of the prediction generator, just append a window and a difference array
to an existing list.<br />
:param time: newly predicted timestamp
:param event: newly predicted event</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">append_to_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    instead of calling ATMDataset and Dataloader on each iterative call </span>
<span class="sd">    of the prediction generator, just append a window and a difference array</span>
<span class="sd">    to an existing list.  </span>
<span class="sd">    :param time: newly predicted timestamp</span>
<span class="sd">    :param event: newly predicted event </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_time_seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">last_event_seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">new_time_seq</span> <span class="o">=</span> <span class="n">last_time_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">new_event_seq</span> <span class="o">=</span> <span class="n">last_event_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">new_time_seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="n">new_event_seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_time_seq</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_event_seq</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">append_one_difference_array</span><span class="p">(</span><span class="n">new_time_seq</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.backtracking_prediction_tree" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">backtracking_prediction_tree</span><span class="p">(</span><span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">,</span> <span class="n">c_d</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">current_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>use backtracking to generate all the paths from the given 
last timestamp and marker considering the input degree as a threshold 
and the maximum depth for the generated tree.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">backtracking_prediction_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">,</span> <span class="n">c_d</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span><span class="n">current_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    use backtracking to generate all the paths from the given </span>
<span class="sd">    last timestamp and marker considering the input degree as a threshold </span>
<span class="sd">    and the maximum depth for the generated tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">c_d</span> <span class="o">&gt;=</span> <span class="n">depth</span><span class="p">:</span> 
        <span class="c1"># base case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">current_path</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="n">p_t</span><span class="p">,</span> <span class="n">p_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sorted_wrapper</span><span class="p">(</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">p_e</span> <span class="ow">in</span> <span class="n">p_events</span><span class="p">[:</span><span class="n">degree</span><span class="p">]:</span>
        <span class="c1"># filter branching degree ; the list is already sorted</span>
        <span class="c1"># therefore the &quot;degree&quot; most probable are taken</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_to_log</span><span class="p">(</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 
        <span class="n">current_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p_t</span><span class="p">,</span> <span class="n">p_e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backtracking_prediction_tree</span><span class="p">(</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c_d</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">current_path</span><span class="p">))</span>    
        <span class="n">current_path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_from_log</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.check_input_uniqueness" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">check_input_uniqueness</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>the input df must contain only one process. hence check if thereis one unique case_id</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_input_uniqueness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    the input df must contain only one process. hence check if thereis one unique case_id </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.decode_paths" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">decode_paths</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>used for decoding the events and timestamps in the generated paths.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decode_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    used for decoding the events and timestamps in the generated paths. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO: decode time</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">decoded_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span> 
        <span class="n">encoded_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">event_index</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">event_index</span><span class="p">)</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span>
        <span class="n">encoded_events</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">encoded_events</span><span class="p">))</span>
        <span class="n">decoded_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">activity_le</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">encoded_events</span><span class="p">)</span>


        <span class="n">decoded_path</span><span class="o">=</span> <span class="p">[(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">event</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">_</span><span class="p">)),</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">decoded_events</span><span class="p">)</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoded_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decoded_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.get_differences" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_differences</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>calculates time differences.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_differences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculates time differences. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">local</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span><span class="p">:</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">seq</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="n">local</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">local</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.get_dummy_process" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_dummy_process</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">case_id_column</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>just used for testing; create a dummy input df.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_dummy_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">case_id_column</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    just used for testing; create a dummy input df.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">random_case_id</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">case_id_column</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dummy</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">case_id_column</span><span class="p">]</span><span class="o">==</span><span class="n">random_case_id</span><span class="p">]</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="n">dummy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n_rows</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ProcessTooShort</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dummy</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">n_rows</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.jsonify_paths" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">jsonify_paths</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>note that we just save the
probability of the last pair (time, event) in the path, 
since the nn calculates lambda*(t), which is 
the probability of the last predicted event happening
in the predicted time t.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">jsonify_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    note that we just save the</span>
<span class="sd">    probability of the last pair (time, event) in the path, </span>
<span class="sd">    since the nn calculates lambda*(t), which is </span>
<span class="sd">    the probability of the last predicted event happening</span>
<span class="sd">    in the predicted time t. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;paths&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoded_paths</span> <span class="p">:</span>
        <span class="n">current_path</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;pairs&#39;</span><span class="p">:[],</span> 
            <span class="s1">&#39;percentage&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">per</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">current_path</span><span class="p">[</span><span class="s2">&quot;pairs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> 
                    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="n">event</span><span class="p">,</span> 
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="n">ans</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.jsonify_single" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">jsonify_single</span><span class="p">(</span><span class="n">time_pred</span><span class="p">,</span> <span class="n">event_pred</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>note that we just save the
probability of the last pair (time, event) in the path, 
since the nn calculates lambda*(t) (see paper), which is 
the probability of the last predicted event happening
in the predicted time t.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">jsonify_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_pred</span><span class="p">,</span> <span class="n">event_pred</span><span class="p">,</span> <span class="n">prob</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    note that we just save the</span>
<span class="sd">    probability of the last pair (time, event) in the path, </span>
<span class="sd">    since the nn calculates lambda*(t) (see paper), which is </span>
<span class="sd">    the probability of the last predicted event happening</span>
<span class="sd">    in the predicted time t. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time_pred</span><span class="p">,</span> 
        <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">activity_le</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">event_pred</span><span class="p">),</span>
        <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="n">prob</span>
    <span class="p">}</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.linear_iterative_predictor" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">linear_iterative_predictor</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">start_event</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>TODO: merge this fucntion with linear_iterative_predictor</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">linear_iterative_predictor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">start_event</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: merge this fucntion with linear_iterative_predictor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c_t</span> <span class="o">=</span> <span class="n">start_time</span>
    <span class="n">c_e</span> <span class="o">=</span> <span class="n">start_event</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c_t</span> <span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c_e</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span> 
        <span class="n">p_t</span><span class="p">,</span> <span class="n">p_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sorted_wrapper</span><span class="p">()</span>
        <span class="n">p_pair</span> <span class="o">=</span> <span class="n">p_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">p_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_to_log</span><span class="p">(</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.linear_iterative_predictor_non_stop" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">linear_iterative_predictor_non_stop</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">start_event</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>:param start_time: used to mark the start of the path 
:param start_event: used to mark the start of the path
:param upper: upper bound for the amount of iterations</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">linear_iterative_predictor_non_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">start_event</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param start_time: used to mark the start of the path </span>
<span class="sd">    :param start_event: used to mark the start of the path</span>
<span class="sd">    :param upper: upper bound for the amount of iterations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c_t</span> <span class="o">=</span> <span class="n">start_time</span>
    <span class="n">c_e</span> <span class="o">=</span> <span class="n">start_event</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">c_t</span> <span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c_e</span><span class="p">))]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#TODO: set upper bound as default to INFTY</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_activities</span><span class="p">[</span><span class="n">c_e</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">upper</span><span class="p">:</span> <span class="c1">#stop if end activity found or upper bound crossed</span>
        <span class="n">p_t</span><span class="p">,</span> <span class="n">p_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sorted_wrapper</span><span class="p">()</span> <span class="c1">#get prediction</span>
        <span class="n">p_pair</span> <span class="o">=</span> <span class="n">p_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#get pair (prob, event)</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">p_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)))</span> <span class="c1">#save to path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_to_log</span><span class="p">(</span><span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#update log for recusrive call</span>
        <span class="n">c_t</span> <span class="o">=</span> <span class="n">p_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">c_e</span> <span class="o">=</span> <span class="n">p_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="c1">#save generated path </span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.multiple_prediction" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">multiple_prediction</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>get a list of possible paths starting at the last 
timestamp and event pair.<br />
:param depth: how many steps in the future are to be predicted.
:param degree: how many predictions on each step are to be considered.
:param config: configuration used for the NN. required by ATM Dataset</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multiple_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get a list of possible paths starting at the last </span>
<span class="sd">    timestamp and event pair.  </span>
<span class="sd">    :param depth: how many steps in the future are to be predicted.</span>
<span class="sd">    :param degree: how many predictions on each step are to be considered.</span>
<span class="sd">    :param config: configuration used for the NN. required by ATM Dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c_t</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">c_e</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#:load data, get windows</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">=</span> <span class="n">ATMDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">time_seqs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">event_seqs</span>

    <span class="c1">#:get differences</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_differences</span><span class="p">()</span>

    <span class="c1">#: compute paths</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backtracking_prediction_tree</span><span class="p">(</span><span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,[(</span><span class="n">c_t</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c_e</span><span class="p">))])</span> 

    <span class="c1">#: decode paths</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decode_paths</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.multiple_prediction_dataframe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">multiple_prediction_dataframe</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">non_stop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>make multiple predictions given a dataframe
preprocessor is in charge of doing the
reading/importing from csv, xes, commandline, etc...
it is assumed that the event log contains only one case id.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multiple_prediction_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">non_stop</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make multiple predictions given a dataframe</span>
<span class="sd">    preprocessor is in charge of doing the</span>
<span class="sd">    reading/importing from csv, xes, commandline, etc...</span>
<span class="sd">    it is assumed that the event log contains only one case id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">Preprocessing</span><span class="p">()</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">import_event_log_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">event_df</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">current_case_id</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">linear</span><span class="p">:</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        case backtracking needed </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple_prediction</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the linear version is only being used for</span>
<span class="sd">        the iterative use of the multiple prediction generation.</span>
<span class="sd">        it mostly contains optimizations that are only </span>
<span class="sd">        tought for the iterative generation prediction </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple_prediction_linear</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">non_stop</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.multiple_prediction_linear" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">multiple_prediction_linear</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">nonstop</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>this is a special case of multiple prediction
where the degree= 1. we avoid backtracking and recursion for
efficiency reasons.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multiple_prediction_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">nonstop</span> <span class="p">,</span><span class="n">upper</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this is a special case of multiple prediction</span>
<span class="sd">    where the degree= 1. we avoid backtracking and recursion for</span>
<span class="sd">    efficiency reasons.  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: get the event and timestamp of the last event in the partial process.</span>
    <span class="n">c_t</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">c_e</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#: compute sliding window</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">=</span> <span class="n">ATMDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">time_seqs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive_atm</span><span class="o">.</span><span class="n">event_seqs</span>

    <span class="c1">#: compute differences within each window</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_differences</span><span class="p">()</span>


    <span class="k">if</span> <span class="n">nonstop</span><span class="p">:</span> 
        <span class="c1">#: in case that we run until end activity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_iterative_predictor_non_stop</span><span class="p">(</span><span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#: in case we run until a given depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_iterative_predictor</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">c_t</span><span class="p">,</span> <span class="n">c_e</span><span class="p">)</span> 

    <span class="c1">#: decode the generated paths</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decode_paths</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.pop_from_log" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">pop_from_log</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>used for backtracking to restore the old path</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pop_from_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    used for backtracking to restore the old path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_seqs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_event_seqs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recursive_time_diffs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.single_prediction" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">single_prediction</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>make one prediction given a partial process.</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">single_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make one prediction given a partial process. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: sliding window</span>
    <span class="n">step1</span><span class="o">=</span> <span class="n">ATMDataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">)</span>
    <span class="c1">#: just create one batch</span>
    <span class="n">step2</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">step1</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">step1</span><span class="o">.</span><span class="n">time_seqs</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">ATMDataset</span><span class="o">.</span><span class="n">to_features</span><span class="p">)</span>

    <span class="c1">#: TODO: refactor these lines here. no need for a for loop</span>
    <span class="n">pred_times</span><span class="p">,</span> <span class="n">pred_events</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">step2</span><span class="p">):</span>   
        <span class="n">pred_time</span><span class="p">,</span> <span class="n">pred_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">pm_active</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">pred_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_time</span><span class="p">)</span>
        <span class="n">pred_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_event</span><span class="p">)</span>
    <span class="n">time_pred</span> <span class="o">=</span> <span class="n">pred_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">event_pred</span> <span class="o">=</span> <span class="n">pred_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 

    <span class="k">return</span> <span class="n">time_pred</span><span class="p">,</span>  <span class="n">event_pred</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.prediction_manager.PredictionManager.single_prediction_dataframe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">single_prediction_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>make one prediction given a dataframe. 
preprocessor is in charge of doing the
reading/importing from csv, xes, commandline, etc...</p>

          <details class="quote">
            <summary>Source code in <code>server/prediction_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">single_prediction_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make one prediction given a dataframe. </span>
<span class="sd">    preprocessor is in charge of doing the</span>
<span class="sd">    reading/importing from csv, xes, commandline, etc...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">Preprocessing</span><span class="p">()</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">import_event_log_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_key</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">event_df</span> 

    <span class="c1">#: check case id uniqueness</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_input_uniqueness</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">NotOneCaseId</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_case_id</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoded_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_prediction</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><h1 id="process-model-manager">Process model manager</h1>


<div class="doc doc-object doc-module">



<a id="server.process_model_manager"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="server.process_model_manager.ProcessModelManager" class="doc doc-heading">
          <code>ProcessModelManager</code>


</h2>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>server/process_model_manager.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProcessModelManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event_df</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">case_activity_key</span><span class="p">,</span> <span class="n">case_id_key</span><span class="p">,</span> <span class="n">case_timestamp_key</span>  <span class="p">):</span>
        <span class="c1">#: it is assumed that the model already exists.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span><span class="n">model</span>  <span class="c1">#genertaed model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span> <span class="o">=</span> <span class="n">case_activity_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span> <span class="o">=</span> <span class="n">case_id_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="o">=</span> <span class="n">case_timestamp_key</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span><span class="n">config</span>  <span class="c1">#config of the nn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span> <span class="o">=</span><span class="n">event_df</span>  <span class="c1">#the df use for preprocessing and training </span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_activities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># variables to store PM model for further Conformance checking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initialize_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        initialize variabels for predictive log generator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">case_id_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">:[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">:[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">:[]</span>
        <span class="p">}</span>
        <span class="n">input_sequences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span>

    <span class="k">def</span> <span class="nf">random_cutter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        cuts the each sequence contained in input sequences at random indices. </span>
<span class="sd">        :param cuts: the cut index and cut length are preserved</span>
<span class="sd">        :param case_id_counts: number of rows for each case_id</span>
<span class="sd">        :max_len: max length that the input sequence can have. can be set to improve runtime </span>
<span class="sd">        TODO: allow INF for max_len</span>
<span class="sd">        :param input_sequences: list of sequences to be cut. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">case_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_id_counts</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">case_id_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">case_id</span><span class="p">]</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">==</span><span class="n">case_id</span><span class="p">]</span>  
            <span class="k">if</span> <span class="n">count</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span> <span class="ow">or</span> <span class="n">count</span><span class="o">&gt;</span><span class="n">max_len</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cut</span><span class="p">]</span>
            <span class="n">cuts</span><span class="p">[</span><span class="n">case_id</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">count</span><span class="o">-</span><span class="n">cut</span><span class="p">)</span>
            <span class="n">input_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span> <span class="n">sequence</span><span class="p">],</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span> 

    <span class="k">def</span> <span class="nf">fill_up_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upper</span> <span class="p">,</span> <span class="n">non_stop</span> <span class="p">,</span> <span class="n">random_cuts</span> <span class="p">,</span> <span class="n">cut_length</span> <span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        do the predictions for each cut sequence and extend the event log so that </span>
<span class="sd">        it now constains the predictions. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: initialize prediction manager.</span>
        <span class="n">pm</span><span class="o">=</span> <span class="n">PredictionManager</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
        <span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">end_activities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_activities</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">input_sequences</span><span class="p">)):</span> 
            <span class="n">case_id</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1">#: do the predictions in the corresponding mode</span>
            <span class="n">pm</span><span class="o">.</span><span class="n">multiple_prediction_dataframe</span><span class="p">(</span>
                <span class="n">cuts</span><span class="p">[</span><span class="n">case_id</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="n">sequence</span><span class="p">,</span> 
                <span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">,</span>  
                <span class="n">non_stop</span><span class="o">=</span><span class="n">non_stop</span><span class="p">,</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="n">upper</span><span class="p">,</span> 
            <span class="p">)</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">decoded_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">extension</span> <span class="o">=</span> <span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">:[],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">:[],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">:[]</span>
            <span class="p">}</span>
            <span class="c1">#: arrange the predictions in the extension dictionary</span>
            <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="ow">in</span> <span class="n">prediction</span><span class="p">:</span> 
                <span class="n">extension</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">case_id</span><span class="p">]</span>
                <span class="n">extension</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="p">]</span>
                <span class="n">extension</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">=</span> <span class="p">[</span><span class="n">time</span><span class="p">]</span>

            <span class="c1">#: transform extension to dtaframe and extend the predictive df now with the predictions</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span> <span class="n">extension</span><span class="p">],</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">generate_predictive_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_log_path</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">non_stop</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">random_cuts</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cut_length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generates a predictive log. each process is cut at some given index, and the model is used to </span>
<span class="sd">        reconstruct the rest of the process. there are so far three possible modi for cutting and prediction generation:  </span>
<span class="sd">        - for tail cuts: set cut_length value and set random_cuts to false</span>
<span class="sd">        - for random cuts with cut memory: random_cuts to true and non_stop to false</span>
<span class="sd">        - for random cuts nonstop: random_cuts to true and non_stop totrue </span>

<span class="sd">        :param max len: max length for the cut sequences ie max sequence input size length.</span>
<span class="sd">        :param upper:  upperbound for the non stop random cutter ie how long to run before reaching end state. </span>
<span class="sd">        :param non_stop: must be set to true if the predictions are done until reaching final marking.</span>
<span class="sd">        :param random_cuts: set to true to cut in random indices. </span>
<span class="sd">        :param cut_length: in case of cutting fix tail lengths, select the tail length to cut for all sequences.</span>
<span class="sd">        :param upper: upper bound for how many iterations a non stop iterative predictor should run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">st</span><span class="o">=</span> <span class="n">tim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_variables</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random_cuts</span><span class="p">:</span> 
            <span class="n">case_id_counts</span><span class="p">,</span><span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_cutter</span><span class="p">(</span><span class="n">case_id_counts</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span><span class="n">cuts</span><span class="p">,</span>  <span class="n">input_sequences</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">cut_length</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
                <span class="k">raise</span> <span class="n">CutLengthZero</span><span class="p">()</span>
            <span class="n">case_id_counts</span><span class="p">,</span><span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail_cutter</span><span class="p">(</span><span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cut_length</span><span class="p">,</span><span class="n">cuts</span><span class="p">,</span>  <span class="n">input_sequences</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">check_too_short</span><span class="p">(</span><span class="n">input_sequences</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_log</span><span class="p">(</span> <span class="n">upper</span> <span class="p">,</span> <span class="n">non_stop</span> <span class="p">,</span> <span class="n">random_cuts</span> <span class="p">,</span> <span class="n">cut_length</span> <span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span><span class="p">)</span>

        <span class="n">logger_generate_predictive_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;generated df:&quot;</span><span class="p">)</span>        
        <span class="n">logger_generate_predictive_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>        

        <span class="n">et</span><span class="o">=</span> <span class="n">tim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">logger_generate_predictive_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;pred df creation duration:&quot;</span><span class="p">)</span>        
        <span class="n">logger_generate_predictive_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">et</span><span class="o">-</span><span class="n">st</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">new_log_path</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">check_too_short</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequences</span><span class="p">):</span>
        <span class="n">lenths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lenths</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">i</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found too short sequence&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CutTooLarge</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tail_cutter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cut_length</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        cut sequences cut_length steps from the tail.</span>
<span class="sd">        :param cut_length: how many steps to cut from the tail of each sequence. </span>
<span class="sd">        :param case_id_counts: number of steps on each case_id</span>
<span class="sd">        :param input_sequences: list of sequences to be cut. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">case_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_id_counts</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">case_id_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">case_id</span><span class="p">]</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="n">count</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">cut_length</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span>
            <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">==</span><span class="n">case_id</span><span class="p">]</span>  
            <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cut</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span><span class="p">:</span> 
                <span class="k">continue</span>
            <span class="n">cuts</span><span class="p">[</span><span class="n">case_id</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">count</span><span class="o">-</span><span class="n">cut</span><span class="p">)</span>
            <span class="n">input_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

            <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span> <span class="n">sequence</span><span class="p">],</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span> 



    <span class="k">def</span> <span class="nf">decode_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        decodes the input sequence that ocntains a df.  </span>
<span class="sd">        :return: sequence that has been decoded. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sequence</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">activity_le</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sequence</span>


    <span class="k">def</span> <span class="nf">handle_nat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the inverse transformation for timestamps is a lossy transformation and might lead to NaT entries. </span>
<span class="sd">        a timedelta of k second&#39;s with respect to the last valid timestamp is set as a timestamp value for </span>
<span class="sd">        the kth NaT entry.</span>
<span class="sd">        :param group: a group in the predictive df that contains only one case id. </span>
<span class="sd">        :return: the same group now with valid timestamps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_valid_idx</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">last_valid_index</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">last_valid_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">group</span>
        <span class="n">last_valid_timestamp</span><span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">last_valid_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span>

        <span class="n">nat_indices</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nat_indices</span><span class="p">):</span>
            <span class="n">group</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_valid_timestamp</span><span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">group</span>     





    <span class="k">def</span> <span class="nf">decode_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        decodes the predictive df; inverse transform timestamps and event names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
        <span class="c1">#: note that this operation is lossy and might generate NaT. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">exponent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>

        <span class="c1">#: handle NaT values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_nat</span><span class="p">)</span>

        <span class="c1">#: save the generated predictive model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;logs/predicted_df&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">import_predictive_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        used for importing a predictive df. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">heuristic_miner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span>  <span class="n">dependency_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">and_threshold</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">loop_two_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        run heuristic miner on the predictive log and generate a petri net.</span>
<span class="sd">        :param path: path used for saving the generated petri net. </span>
<span class="sd">        :param dependency_threshold: dependency threshold parameter for heursitic miner</span>
<span class="sd">        :param and_threshold:  and threshold parameter for heursitic miner</span>
<span class="sd">        :param loop_two_threshold:  loop two thrshold parameter for heursitic miner</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">discover_petri_net_heuristics</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span>
            <span class="n">dependency_threshold</span><span class="p">,</span> 
            <span class="n">and_threshold</span><span class="p">,</span> 
            <span class="n">loop_two_threshold</span><span class="p">,</span> 
            <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
            <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span>
            <span class="n">case_id_key</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span>
        <span class="p">)</span>
        <span class="c1">#pm4py.view_petri_net(self.petri_net, self.initial_marking, self.final_marking, format=&#39;svg&#39;)</span>
        <span class="c1">#: export the petri net in the given path</span>
        <span class="n">pm4py</span><span class="o">.</span><span class="n">write_pnml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">inductive_miner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>   <span class="n">noise_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        run inductive miner on the predictive log and generate a petri net.</span>
<span class="sd">        :param path: path used for saving the generated petri net. </span>
<span class="sd">        :param noise_threshold: noise threshold parameter for inductive miner</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">discover_petri_net_inductive</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span>
            <span class="n">noise_threshold</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span>
        <span class="p">)</span>
        <span class="c1">#pm4py.view_petri_net(self.petri_net, self.initial_marking, self.final_marking, format=&#39;svg&#39;)</span>
        <span class="n">pm4py</span><span class="o">.</span><span class="n">write_pnml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">alpha_miner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        run alpha miner on the predictive log and generate a petri net.</span>
<span class="sd">        :param path: path used for saving the generated petri net. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">discover_petri_net_alpha</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span>
        <span class="p">)</span>
        <span class="c1">#pm4py.view_petri_net(self.petri_net, self.initial_marking, self.final_marking, format=&#39;svg&#39;)</span>
        <span class="n">pm4py</span><span class="o">.</span><span class="n">write_pnml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prefix_tree_miner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        run prefix tre miner on the predictive log and generate a petri net.</span>
<span class="sd">        :param path: path used for saving the generated petri net. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decode_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">discover_prefix_tree</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span>
        <span class="p">)</span>
        <span class="c1">#pm4py.view_petri_net(self.petri_net, self.initial_marking, self.final_marking, format=&#39;svg&#39;)</span>
        <span class="n">pm4py</span><span class="o">.</span><span class="n">write_pnml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        might be irrelevant as we require to always have a case_identifier in the log input </span>
<span class="sd">        -&gt; correlation miner only useful if we do not have or know the case_identifier</span>
<span class="sd">        def correlation_miner(self):</span>
<span class="sd">        pass</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">conformance_checking_token_based_replay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">replayed_traces</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">conformance_diagnostics_token_based_replay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.alpha_miner" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">alpha_miner</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>run alpha miner on the predictive log and generate a petri net.
:param path: path used for saving the generated petri net.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">alpha_miner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    run alpha miner on the predictive log and generate a petri net.</span>
<span class="sd">    :param path: path used for saving the generated petri net. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decode_df</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">discover_petri_net_alpha</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span>
    <span class="p">)</span>
    <span class="c1">#pm4py.view_petri_net(self.petri_net, self.initial_marking, self.final_marking, format=&#39;svg&#39;)</span>
    <span class="n">pm4py</span><span class="o">.</span><span class="n">write_pnml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.decode_df" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">decode_df</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>decodes the predictive df; inverse transform timestamps and event names.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decode_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    decodes the predictive df; inverse transform timestamps and event names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
    <span class="c1">#: note that this operation is lossy and might generate NaT. </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">exponent</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>

    <span class="c1">#: handle NaT values</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_nat</span><span class="p">)</span>

    <span class="c1">#: save the generated predictive model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;logs/predicted_df&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.decode_sequence" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">decode_sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>decodes the input sequence that ocntains a df.<br />
:return: sequence that has been decoded.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decode_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    decodes the input sequence that ocntains a df.  </span>
<span class="sd">    :return: sequence that has been decoded. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sequence</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">activity_le</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sequence</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.fill_up_log" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fill_up_log</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span> <span class="n">non_stop</span><span class="p">,</span> <span class="n">random_cuts</span><span class="p">,</span> <span class="n">cut_length</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>do the predictions for each cut sequence and extend the event log so that 
it now constains the predictions.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fill_up_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upper</span> <span class="p">,</span> <span class="n">non_stop</span> <span class="p">,</span> <span class="n">random_cuts</span> <span class="p">,</span> <span class="n">cut_length</span> <span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    do the predictions for each cut sequence and extend the event log so that </span>
<span class="sd">    it now constains the predictions. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: initialize prediction manager.</span>
    <span class="n">pm</span><span class="o">=</span> <span class="n">PredictionManager</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
    <span class="p">)</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">end_activities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_activities</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">input_sequences</span><span class="p">)):</span> 
        <span class="n">case_id</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#: do the predictions in the corresponding mode</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">multiple_prediction_dataframe</span><span class="p">(</span>
            <span class="n">cuts</span><span class="p">[</span><span class="n">case_id</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">sequence</span><span class="p">,</span> 
            <span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">,</span>  
            <span class="n">non_stop</span><span class="o">=</span><span class="n">non_stop</span><span class="p">,</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">upper</span><span class="p">,</span> 
        <span class="p">)</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">decoded_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">extension</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">:[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">:[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">:[]</span>
        <span class="p">}</span>
        <span class="c1">#: arrange the predictions in the extension dictionary</span>
        <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="ow">in</span> <span class="n">prediction</span><span class="p">:</span> 
            <span class="n">extension</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">case_id</span><span class="p">]</span>
            <span class="n">extension</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">]</span><span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="p">]</span>
            <span class="n">extension</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">=</span> <span class="p">[</span><span class="n">time</span><span class="p">]</span>

        <span class="c1">#: transform extension to dtaframe and extend the predictive df now with the predictions</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span> <span class="n">extension</span><span class="p">],</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.generate_predictive_log" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_predictive_log</span><span class="p">(</span><span class="n">new_log_path</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">non_stop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_cuts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cut_length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>generates a predictive log. each process is cut at some given index, and the model is used to 
reconstruct the rest of the process. there are so far three possible modi for cutting and prediction generation:<br />
- for tail cuts: set cut_length value and set random_cuts to false
- for random cuts with cut memory: random_cuts to true and non_stop to false
- for random cuts nonstop: random_cuts to true and non_stop totrue </p>
<p>:param max len: max length for the cut sequences ie max sequence input size length.
:param upper:  upperbound for the non stop random cutter ie how long to run before reaching end state. 
:param non_stop: must be set to true if the predictions are done until reaching final marking.
:param random_cuts: set to true to cut in random indices. 
:param cut_length: in case of cutting fix tail lengths, select the tail length to cut for all sequences.
:param upper: upper bound for how many iterations a non stop iterative predictor should run.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_predictive_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_log_path</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">non_stop</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">random_cuts</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cut_length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    generates a predictive log. each process is cut at some given index, and the model is used to </span>
<span class="sd">    reconstruct the rest of the process. there are so far three possible modi for cutting and prediction generation:  </span>
<span class="sd">    - for tail cuts: set cut_length value and set random_cuts to false</span>
<span class="sd">    - for random cuts with cut memory: random_cuts to true and non_stop to false</span>
<span class="sd">    - for random cuts nonstop: random_cuts to true and non_stop totrue </span>

<span class="sd">    :param max len: max length for the cut sequences ie max sequence input size length.</span>
<span class="sd">    :param upper:  upperbound for the non stop random cutter ie how long to run before reaching end state. </span>
<span class="sd">    :param non_stop: must be set to true if the predictions are done until reaching final marking.</span>
<span class="sd">    :param random_cuts: set to true to cut in random indices. </span>
<span class="sd">    :param cut_length: in case of cutting fix tail lengths, select the tail length to cut for all sequences.</span>
<span class="sd">    :param upper: upper bound for how many iterations a non stop iterative predictor should run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">st</span><span class="o">=</span> <span class="n">tim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_variables</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">random_cuts</span><span class="p">:</span> 
        <span class="n">case_id_counts</span><span class="p">,</span><span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_cutter</span><span class="p">(</span><span class="n">case_id_counts</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span><span class="n">cuts</span><span class="p">,</span>  <span class="n">input_sequences</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">cut_length</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="n">CutLengthZero</span><span class="p">()</span>
        <span class="n">case_id_counts</span><span class="p">,</span><span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail_cutter</span><span class="p">(</span><span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cut_length</span><span class="p">,</span><span class="n">cuts</span><span class="p">,</span>  <span class="n">input_sequences</span><span class="p">)</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">check_too_short</span><span class="p">(</span><span class="n">input_sequences</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fill_up_log</span><span class="p">(</span> <span class="n">upper</span> <span class="p">,</span> <span class="n">non_stop</span> <span class="p">,</span> <span class="n">random_cuts</span> <span class="p">,</span> <span class="n">cut_length</span> <span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span><span class="p">)</span>

    <span class="n">logger_generate_predictive_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;generated df:&quot;</span><span class="p">)</span>        
    <span class="n">logger_generate_predictive_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>        

    <span class="n">et</span><span class="o">=</span> <span class="n">tim</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">logger_generate_predictive_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;pred df creation duration:&quot;</span><span class="p">)</span>        
    <span class="n">logger_generate_predictive_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">et</span><span class="o">-</span><span class="n">st</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">new_log_path</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.handle_nat" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">handle_nat</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>the inverse transformation for timestamps is a lossy transformation and might lead to NaT entries. 
a timedelta of k second's with respect to the last valid timestamp is set as a timestamp value for 
the kth NaT entry.
:param group: a group in the predictive df that contains only one case id. 
:return: the same group now with valid timestamps</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">handle_nat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    the inverse transformation for timestamps is a lossy transformation and might lead to NaT entries. </span>
<span class="sd">    a timedelta of k second&#39;s with respect to the last valid timestamp is set as a timestamp value for </span>
<span class="sd">    the kth NaT entry.</span>
<span class="sd">    :param group: a group in the predictive df that contains only one case id. </span>
<span class="sd">    :return: the same group now with valid timestamps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_valid_idx</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">last_valid_index</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">last_valid_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">group</span>
    <span class="n">last_valid_timestamp</span><span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">last_valid_idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span>

    <span class="n">nat_indices</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nat_indices</span><span class="p">):</span>
        <span class="n">group</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_valid_timestamp</span><span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">group</span>     
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.heuristic_miner" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">heuristic_miner</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dependency_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">and_threshold</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">loop_two_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>run heuristic miner on the predictive log and generate a petri net.
:param path: path used for saving the generated petri net. 
:param dependency_threshold: dependency threshold parameter for heursitic miner
:param and_threshold:  and threshold parameter for heursitic miner
:param loop_two_threshold:  loop two thrshold parameter for heursitic miner</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">heuristic_miner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span>  <span class="n">dependency_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">and_threshold</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">loop_two_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    run heuristic miner on the predictive log and generate a petri net.</span>
<span class="sd">    :param path: path used for saving the generated petri net. </span>
<span class="sd">    :param dependency_threshold: dependency threshold parameter for heursitic miner</span>
<span class="sd">    :param and_threshold:  and threshold parameter for heursitic miner</span>
<span class="sd">    :param loop_two_threshold:  loop two thrshold parameter for heursitic miner</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decode_df</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">discover_petri_net_heuristics</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span>
        <span class="n">dependency_threshold</span><span class="p">,</span> 
        <span class="n">and_threshold</span><span class="p">,</span> 
        <span class="n">loop_two_threshold</span><span class="p">,</span> 
        <span class="n">activity_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
        <span class="n">timestamp_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span>
        <span class="n">case_id_key</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span>
    <span class="p">)</span>
    <span class="c1">#pm4py.view_petri_net(self.petri_net, self.initial_marking, self.final_marking, format=&#39;svg&#39;)</span>
    <span class="c1">#: export the petri net in the given path</span>
    <span class="n">pm4py</span><span class="o">.</span><span class="n">write_pnml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.import_predictive_df" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">import_predictive_df</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>used for importing a predictive df.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">import_predictive_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    used for importing a predictive df. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.inductive_miner" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">inductive_miner</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">noise_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>run inductive miner on the predictive log and generate a petri net.
:param path: path used for saving the generated petri net. 
:param noise_threshold: noise threshold parameter for inductive miner</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">inductive_miner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>   <span class="n">noise_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    run inductive miner on the predictive log and generate a petri net.</span>
<span class="sd">    :param path: path used for saving the generated petri net. </span>
<span class="sd">    :param noise_threshold: noise threshold parameter for inductive miner</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decode_df</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">discover_petri_net_inductive</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span>
        <span class="n">noise_threshold</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span>
    <span class="p">)</span>
    <span class="c1">#pm4py.view_petri_net(self.petri_net, self.initial_marking, self.final_marking, format=&#39;svg&#39;)</span>
    <span class="n">pm4py</span><span class="o">.</span><span class="n">write_pnml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.initialize_variables" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">initialize_variables</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>initialize variabels for predictive log generator</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">initialize_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    initialize variabels for predictive log generator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">case_id_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    <span class="n">cuts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span> <span class="o">=</span> <span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">:[],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">:[],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">:[]</span>
    <span class="p">}</span>
    <span class="n">input_sequences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cuts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">,</span> <span class="n">cuts</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.prefix_tree_miner" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">prefix_tree_miner</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>run prefix tre miner on the predictive log and generate a petri net.
:param path: path used for saving the generated petri net.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prefix_tree_miner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    run prefix tre miner on the predictive log and generate a petri net.</span>
<span class="sd">    :param path: path used for saving the generated petri net. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">decode_df</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="o">=</span> <span class="n">pm4py</span><span class="o">.</span><span class="n">discover_prefix_tree</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_activity_key</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_timestamp_key</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span>
    <span class="p">)</span>
    <span class="c1">#pm4py.view_petri_net(self.petri_net, self.initial_marking, self.final_marking, format=&#39;svg&#39;)</span>
    <span class="n">pm4py</span><span class="o">.</span><span class="n">write_pnml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">petri_net</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_marking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_marking</span> <span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    might be irrelevant as we require to always have a case_identifier in the log input </span>
<span class="sd">    -&gt; correlation miner only useful if we do not have or know the case_identifier</span>
<span class="sd">    def correlation_miner(self):</span>
<span class="sd">    pass</span>
<span class="sd">    &#39;&#39;&#39;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.random_cutter" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">random_cutter</span><span class="p">(</span><span class="n">case_id_counts</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>cuts the each sequence contained in input sequences at random indices. 
:param cuts: the cut index and cut length are preserved
:param case_id_counts: number of rows for each case_id
:max_len: max length that the input sequence can have. can be set to improve runtime 
TODO: allow INF for max_len
:param input_sequences: list of sequences to be cut.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">random_cutter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    cuts the each sequence contained in input sequences at random indices. </span>
<span class="sd">    :param cuts: the cut index and cut length are preserved</span>
<span class="sd">    :param case_id_counts: number of rows for each case_id</span>
<span class="sd">    :max_len: max length that the input sequence can have. can be set to improve runtime </span>
<span class="sd">    TODO: allow INF for max_len</span>
<span class="sd">    :param input_sequences: list of sequences to be cut. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">case_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_id_counts</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">case_id_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">case_id</span><span class="p">]</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">==</span><span class="n">case_id</span><span class="p">]</span>  
        <span class="k">if</span> <span class="n">count</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span> <span class="ow">or</span> <span class="n">count</span><span class="o">&gt;</span><span class="n">max_len</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cut</span><span class="p">]</span>
        <span class="n">cuts</span><span class="p">[</span><span class="n">case_id</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">count</span><span class="o">-</span><span class="n">cut</span><span class="p">)</span>
        <span class="n">input_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span> <span class="n">sequence</span><span class="p">],</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span> 
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="server.process_model_manager.ProcessModelManager.tail_cutter" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">tail_cutter</span><span class="p">(</span><span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cut_length</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>cut sequences cut_length steps from the tail.
:param cut_length: how many steps to cut from the tail of each sequence. 
:param case_id_counts: number of steps on each case_id
:param input_sequences: list of sequences to be cut.</p>

          <details class="quote">
            <summary>Source code in <code>server/process_model_manager.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tail_cutter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cut_length</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    cut sequences cut_length steps from the tail.</span>
<span class="sd">    :param cut_length: how many steps to cut from the tail of each sequence. </span>
<span class="sd">    :param case_id_counts: number of steps on each case_id</span>
<span class="sd">    :param input_sequences: list of sequences to be cut. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">case_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_id_counts</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">case_id_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">case_id</span><span class="p">]</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="n">count</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">cut_length</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">event_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">case_id_key</span><span class="p">]</span><span class="o">==</span><span class="n">case_id</span><span class="p">]</span>  
        <span class="n">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cut</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seq_len</span><span class="p">:</span> 
            <span class="k">continue</span>
        <span class="n">cuts</span><span class="p">[</span><span class="n">case_id</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">cut</span><span class="p">,</span> <span class="n">count</span><span class="o">-</span><span class="n">cut</span><span class="p">)</span>
        <span class="n">input_sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">predictive_df</span><span class="p">,</span> <span class="n">sequence</span><span class="p">],</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">case_id_counts</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">input_sequences</span> 
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a7c05c9e.min.js"></script>
      
    
  </body>
</html>